[AndroidDaily原文](https://pages.github.sec.samsung.net/fucong-liu/AndroidDaily/)
---
title: "利用Autofill框架实现生物识别填充"
date: 2025-12-08 08:00:00
categories: ["安卓开发","Autofill框架应用"]
tags: ["Autofill框架","生物识别填充","安卓开发","Android Studio","生物识别权限","依赖库","布局文件","代码实现","常见错误解决"]
---

# 🔐利用Autofill框架实现生物识别填充详细教程

想象一下，你就像一位魔法师，每次登录应用都要手动输入用户名和密码，这就好比每次都要念长长的咒语。而今天我们要学习的利用Autofill框架实现生物识别填充，就像是给你找到了一个魔法助手，让你只需用指纹或者面部识别，就能自动填充登录信息，轻松搞定登录。接下来，我们就一步一步地学习如何打造这个魔法助手。

## 1. 了解Autofill框架和生物识别填充
### 什么是Autofill框架
Autofill框架就像是一个智能的信息仓库管理员。在安卓系统里，它可以帮助应用自动填充一些常用的信息，比如用户名、密码、信用卡信息等。当你在应用里输入某些信息时，它能快速从仓库中找到合适的内容填充进去，就像管理员迅速找到你需要的物品递给你一样。

### 生物识别填充
生物识别填充是在Autofill框架的基础上，加入了生物识别技术。就好比在仓库门口加了一把智能锁，只有通过指纹或者面部识别等生物特征验证后，才能打开仓库取出信息进行填充。这样既方便又安全。

## 2. 准备工作
### 开发环境搭建
首先，你得有一个开发安卓应用的环境。就像盖房子得先有一块合适的地皮一样。你需要安装以下软件：
- **Android Studio**：这是开发安卓应用的主要工具，就像一个功能强大的建筑工厂。你可以从[Android Studio官网](https://developer.android.com/studio)下载安装。
- **Java开发工具包（JDK）**：Java是安卓开发常用的编程语言，JDK就是编写Java代码的工具套装。安装好Android Studio后，它会自动帮你配置好JDK。

### 创建新的安卓项目
打开Android Studio，选择“Start a new Android Studio project”，然后按照向导选择合适的模板，比如“Empty Activity”，就像选择了一个房子的基础户型。填写好项目名称、保存位置等信息，点击“Finish”，项目就创建好了。

## 3. 配置项目
### 添加权限
在项目的`AndroidManifest.xml`文件中添加生物识别权限。这个文件就像是项目的说明书，权限就像是说明书里允许做的事情。在`<manifest>`标签内添加以下代码：
```xml
<uses-permission android:name="android.permission.USE_BIOMETRIC" />
```
这行代码的意思是告诉系统，我们的应用需要使用生物识别功能。

### 依赖库添加
在项目的`build.gradle`（Module: app）文件中添加生物识别相关的依赖库。依赖库就像是项目的配件，能让项目拥有更多功能。在`dependencies`部分添加以下代码：
```groovy
implementation 'androidx.biometric:biometric:1.1.0'
```
这行代码的作用是引入生物识别的相关工具，让我们可以在代码里使用生物识别功能。

## 4. 实现生物识别填充功能
### 布局文件创建
在`res/layout`目录下找到`activity_main.xml`文件，这就像是房子的设计蓝图。我们要在这个蓝图里添加输入框和按钮，用于测试生物识别填充功能。以下是示例代码：
```xml
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    android:padding="16dp">

    <!-- 用户名输入框 -->
    <EditText
        android:id="@+id/et_username"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:hint="Username"
        android:autofillHints="username" />

    <!-- 密码输入框 -->
    <EditText
        android:id="@+id/et_password"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:hint="Password"
        android:inputType="textPassword"
        android:autofillHints="password" />

    <!-- 登录按钮 -->
    <Button
        android:id="@+id/btn_login"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text="Login" />
</LinearLayout>
```
- `EditText`是输入框，就像房子里的信箱，用来接收用户输入的信息。`android:autofillHints`属性告诉Autofill框架这个输入框需要填充的信息类型。
- `Button`是按钮，就像房子的门铃，点击它可以触发登录操作。

### 代码实现
打开`MainActivity.java`文件，我们要在这里编写实现生物识别填充的代码。以下是完整的示例代码：
```java
import androidx.appcompat.app.AppCompatActivity;
import androidx.biometric.BiometricManager;
import androidx.biometric.BiometricPrompt;
import androidx.core.content.ContextCompat;

import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.Toast;

import java.util.concurrent.Executor;

public class MainActivity extends AppCompatActivity {

    private EditText etUsername, etPassword;
    private Button btnLogin;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        // 找到布局文件中的输入框和按钮
        etUsername = findViewById(R.id.et_username);
        etPassword = findViewById(R.id.et_password);
        btnLogin = findViewById(R.id.btn_login);

        // 创建一个线程执行器，用于处理生物识别结果
        Executor executor = ContextCompat.getMainExecutor(this);
        // 创建生物识别提示框
        BiometricPrompt biometricPrompt = new BiometricPrompt(MainActivity.this,
                executor, new BiometricPrompt.AuthenticationCallback() {
            @Override
            public void onAuthenticationError(int errorCode, CharSequence errString) {
                super.onAuthenticationError(errorCode, errString);
                // 生物识别出错时显示提示信息
                Toast.makeText(getApplicationContext(),
                        "Authentication error: " + errString, Toast.LENGTH_SHORT).show();
            }

            @Override
            public void onAuthenticationSucceeded(BiometricPrompt.AuthenticationResult result) {
                super.onAuthenticationSucceeded(result);
                // 生物识别成功时，模拟填充用户名和密码
                etUsername.setText("test_user");
                etPassword.setText("test_password");
                Toast.makeText(getApplicationContext(),
                        "Authentication succeeded!", Toast.LENGTH_SHORT).show();
            }

            @Override
            public void onAuthenticationFailed() {
                super.onAuthenticationFailed();
                // 生物识别失败时显示提示信息
                Toast.makeText(getApplicationContext(), "Authentication failed",
                        Toast.LENGTH_SHORT).show();
            }
        });

        // 创建生物识别提示框的信息
        BiometricPrompt.PromptInfo promptInfo = new BiometricPrompt.PromptInfo.Builder()
               .setTitle("Biometric login for my app")
               .setSubtitle("Log in using your biometric credential")
               .setNegativeButtonText("Use account password")
               .build();

        // 给登录按钮设置点击事件
        btnLogin.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                // 检查设备是否支持生物识别
                BiometricManager biometricManager = BiometricManager.from(MainActivity.this);
                switch (biometricManager.canAuthenticate()) {
                    case BiometricManager.BIOMETRIC_SUCCESS:
                        // 设备支持生物识别，显示生物识别提示框
                        biometricPrompt.authenticate(promptInfo);
                        break;
                    case BiometricManager.BIOMETRIC_ERROR_NO_HARDWARE:
                        // 设备不支持生物识别硬件
                        Toast.makeText(MainActivity.this, "No biometric features available on this device.",
                                Toast.LENGTH_SHORT).show();
                        break;
                    case BiometricManager.BIOMETRIC_ERROR_HW_UNAVAILABLE:
                        // 生物识别硬件不可用
                        Toast.makeText(MainActivity.this, "Biometric features are currently unavailable.",
                                Toast.LENGTH_SHORT).show();
                        break;
                    case BiometricManager.BIOMETRIC_ERROR_NONE_ENROLLED:
                        // 设备未注册生物识别信息
                        Toast.makeText(MainActivity.this,
                                "Your device doesn't have biometric credentials enrolled. Please enroll them in your device settings.",
                                Toast.LENGTH_SHORT).show();
                        break;
                }
            }
        });
    }
}
```
### 代码解释
- **变量声明**：`etUsername`和`etPassword`是输入框对象，`btnLogin`是按钮对象，就像给房子里的信箱和门铃起了名字。
- **`onCreate`方法**：这是活动创建时调用的方法，就像房子建好后要进行的一些初始化布置。
  - `findViewById`方法用于找到布局文件中的输入框和按钮，就像在房子里找到信箱和门铃的位置。
  - `Executor`是一个线程执行器，用于处理生物识别的结果，就像一个快递员，负责传递生物识别的信息。
  - `BiometricPrompt`是生物识别提示框，就像一个智能的门卫，负责验证你的生物特征。
  - `BiometricPrompt.AuthenticationCallback`是生物识别的回调接口，包含了生物识别成功、失败和出错的处理方法，就像门卫会告诉你验证是否通过。
  - `BiometricPrompt.PromptInfo`是生物识别提示框的信息，包括标题、副标题和取消按钮的文字，就像门卫旁边的提示牌。
  - `btnLogin.setOnClickListener`给登录按钮设置了点击事件，当点击按钮时，会检查设备是否支持生物识别，并根据情况显示生物识别提示框。

## 5. 常见错误及解决办法
### 生物识别提示框不显示
- **可能原因**：设备不支持生物识别硬件，或者未注册生物识别信息。
- **解决办法**：检查设备的生物识别设置，确保设备支持生物识别，并且已经注册了指纹或者面部识别信息。

### 填充信息失败
- **可能原因**：Autofill框架配置不正确，或者输入框的`autofillHints`属性设置错误。
- **解决办法**：检查`autofillHints`属性是否正确设置，确保Autofill框架可以正确识别输入框需要填充的信息类型。

## 小结
在这篇教程中，我们学习了如何利用Autofill框架实现生物识别填充。核心内容包括了解Autofill框架和生物识别填充的概念，搭建开发环境，配置项目，创建布局文件，编写代码实现生物识别填充功能，以及解决常见错误。通过这些步骤，我们就像一步一步地搭建好了一个带有智能门锁和自动填充功能的房子。

如果你想进一步学习，可以参考以下资源：
- [Android官方Autofill文档](https://developer.android.com/guide/topics/text/autofill)
- [Android官方生物识别文档](https://developer.android.com/training/sign-in/biometric-auth)

## 下一步建议
- 尝试在不同的安卓设备上运行这个应用，测试生物识别填充功能的兼容性。
- 学习如何将生物识别填充功能集成到更复杂的应用中，比如电商应用的登录和支付页面。
- 探索Autofill框架的更多功能，比如自动填充信用卡信息等。